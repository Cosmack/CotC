plot_coup = {
	type = liege_titles
	murder_plot = yes # Non-justified coups are immoral and characters with moral qualms won't back them
	military_plot = yes
	intrigue_plot = yes
	
	potential = {
		age = 16
		NOT = { trait = incapable }
		prisoner = no
	}
	allow = {		
		# Non-justified coups can't be initiated in circumstances where justified coups could be
		holder_scope = { NOT = { religion = space_pirate } }
		OR = {
			holder_scope = { religion_authority = 0.8 }
			NOT = { FROM = { trait = anti_ruler } }
		}
		OR = {
			holder_scope = { religion_authority = 0.5 }
			holder_scope = { NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_usurped_title } } }
			NOT = { FROM = { has_strong_claim = PREV } }
		}
		OR = {
			holder_scope = { religion_authority = 0.35 }
			NOT = { FROM = { has_strong_claim = PREV } }
		}
		OR = {
			holder_scope = { religion_authority = 0.25 }
			NOT = { FROM = { has_weak_claim = PREV } }
		}
		holder_scope = { religion_authority = 0.1 }
	}
	chance = {
		factor = 1
		
		# Personality Effects
		modifier = {
			factor = 0.1
			FROM = { trait = content }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = friendly }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = craven }
		}
		modifier = {
			factor = 5
			FROM = { trait = ambitious }
		}
		modifier = {
			factor = 2
			FROM = { trait = cold }
		}
		modifier = {
			factor = 2
			FROM = { trait = pragmatic }
		}
		
		# Moral authority effects
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.1 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.2 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.3 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.4 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.5 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.6 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.7 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.8 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.9 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 1 }
		}
		
		# Personal Opinion
		# Unjustified coups will never be launched by vassals with positive opinions
		modifier = {
			factor = 0
			holder_scope = { reverse_opinion = { who = FROM value = 1 } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -9 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -19 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -29 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -39 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -49 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -59 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -69 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -79 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -89 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -99 } } }
		}
	}
	success = { FROM = { has_character_flag = flag_successful_coup } }
	effect = { FROM = { clr_character_flag = flag_successful_coup } }
	abort = { 
		OR = {
			NOT = { holder_scope = { always = yes } } # Title must actually exist and be held by someone
			AND = {
				FROM = { NOT = { has_character_flag = flag_coup_leader } } # Once the coup is underway, it can't be aborted
				NOT = { holder_scope = { any_vassal = { character = FROM } } }
			}
		}
	}
	abort_effect = {
		FROM = {
			clr_character_flag = flag_coup_leader
			clr_character_flag = flag_coup_plan_military
			clr_character_flag = flag_coup_plan_spymaster
			any_plot_backer = {
				limit = {
					NOT = {
						any_backed_character = {
							OR = {
								has_plot = plot_coup
								has_plot = plot_justified_coup
							}
							NOT = { character = FROM }
						}
					}
				}
				clr_character_flag = flag_coup_plan_military
				clr_character_flag = flag_coup_plan_spymaster
			}
		}
	}
}

plot_justified_coup = {
	type = liege_titles
	military_plot = yes
	intrigue_plot = yes
	
	potential = {
		age = 16
		NOT = { trait = incapable }
		prisoner = no
	}
	allow = {
		is_primary_holder_title = yes
		OR = {
			holder_scope = { religion = space_pirate }
			holder_scope = {
				NOT = { religion_authority = 0.8 }
				FROM = { trait = anti_ruler }
			}
			AND = {
				holder_scope = {
					NOT = { religion_authority = 0.5 }
					reverse_has_opinion_modifier = { who = FROM modifier = opinion_usurped_title }
				}
				FROM = { has_strong_claim = PREV }
			}
			AND = {
				holder_scope = { NOT = { religion_authority = 0.35 } }
				FROM = { has_strong_claim = PREV }
			}
			AND = {
				holder_scope = { NOT = { religion_authority = 0.25 } }
				FROM = { has_weak_claim = PREV }
			}
			holder_scope = { NOT = { religion_authority = 0.1 } }
		}
	}
	chance = {
		factor = 10
		
		# Constitutional Crisis Factor
		modifier = {
			factor = 10
			FROM = { trait = anti_ruler }
		}
		modifier = {
			factor = 0
			FROM = { trait = pro_ruler }
		}
		
		# Try to avoid splitting the plot up if possible
		modifier = {
			factor = 0
			holder_scope = {
				any_vassal = {
					has_plot = plot_justified_coup
					NOT = { character = FROM }
					OR = {
						reverse_opinion = { who = FROM value = 25 }
						higher_tier_than = FROM
						FROM = { trait = content }
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				any_backed_character = {
					same_liege = FROM
					has_plot = plot_justified_coup
				}
			}
		}
		
		# Personality Effects
		modifier = {
			factor = 0.1
			FROM = { trait = content }
		}
		modifier = {
			factor = 10
			FROM = { trait = ambitious }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = craven }
		}
		modifier = {
			factor = 2
			FROM = { trait = brave }
		}
		
		# Moral authority effects
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.1 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.2 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.3 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.4 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.5 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.6 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.7 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.8 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 0.9 }
		}
		modifier = {
			factor = 0.8
			holder_scope = { religion_authority = 1 }
		}
		
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 0.1 }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 0.2 }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 0.3 }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 0.4 }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 0.5 }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 0.6 }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 0.7 }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 0.8 }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 0.9 }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { religion = FROM } }
			FROM = { religion_authority = 1 }
		}
		
		# Personal Opinion
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 100 } }
		}
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 90 } }
		}
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 80 } }
		}
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 70 } }
		}
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 60 } }
		}
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 50 } }
		}
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 40 } }
		}
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 30 } }
		}
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 20 } }
		}
		modifier = {
			factor = 0.8
			holder_scope = { reverse_opinion = { who = FROM value = 10 } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -9 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -19 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -29 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -39 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -49 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -59 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -69 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -79 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -89 } } }
		}
		modifier = {
			factor = 1.25
			holder_scope = { NOT = { reverse_opinion = { who = FROM value = -99 } } }
		}
		
		# Legal effects
		modifier = {
			factor = 0.2
			holder_scope = { has_character_modifier = law_for_ruler }
		}
		modifier = {
			factor = 5
			holder_scope = { has_character_modifier = law_against_ruler }
		}
		
		# Things get more desperate the longer a crisis goes on
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 30 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 60 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 90 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 120 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 180 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 210 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 240 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 270 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 300 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 330 }
			}
		}
		modifier = {
			factor = 2
			holder_scope = {
				has_character_flag = flag_crisis_timer
				had_character_flag = { flag = flag_crisis_timer days = 360 }
			}
		}
	}
	success = { FROM = { has_character_flag = flag_successful_coup } }
	effect = { FROM = { clr_character_flag = flag_successful_coup } }
	abort = {
		OR = {
			NOT = { holder_scope = { always = yes } } # Title must actually exist and be held by someone
			AND = {
				FROM = { NOT = { has_character_flag = flag_coup_leader } } # Once the coup is underway, it can't be aborted
				NOT = { holder_scope = { any_vassal = { character = FROM } } }
			}
			AND = {
				FROM = { NOT = { has_character_flag = flag_coup_leader } } # Once the coup is underway, it can't be aborted
				holder_scope = { NOT = { religion = space_pirate } }
				OR = {
					holder_scope = { religion_authority = 0.8 }
					NOT = { FROM = { trait = anti_ruler } }
				}
				OR = {
					holder_scope = { religion_authority = 0.5 }
					holder_scope = { NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_usurped_title } } }
					NOT = { FROM = { has_strong_claim = PREV } }
				}
				OR = {
					holder_scope = { religion_authority = 0.35 }
					NOT = { FROM = { has_strong_claim = PREV } }
				}
				OR = {
					holder_scope = { religion_authority = 0.25 }
					NOT = { FROM = { has_weak_claim = PREV } }
				}
				holder_scope = { religion_authority = 0.1 }
			}
		}
	}
	abort_effect = {
		FROM = {
			clr_character_flag = flag_coup_leader
			clr_character_flag = flag_coup_plan_military
			clr_character_flag = flag_coup_plan_spymaster
			any_plot_backer = {
				limit = {
					NOT = {
						any_backed_character = {
							OR = {
								has_plot = plot_coup
								has_plot = plot_justified_coup
							}
							NOT = { character = FROM }
						}
					}
				}
				clr_character_flag = flag_coup_plan_military
				clr_character_flag = flag_coup_plan_spymaster
			}
		}
	}
}